{"name":"An error in a web-based Thoracoscore calculator","body":"## Bugfixes for SFAR's Thoracoscore calculator\r\n\r\n### tl;dr\r\n\r\nThe [Société Française d’Anesthésie et de Réanimation][1] provides Google's [top-ranked result][2] for a [Thoracoscore][3] calculator. [Their Thorascore calculator][4] has a systematic error that introduces an addition of 0.05% to all scores that it calculates. We provide a patched version of their calculator's Javascript that corrects this error. We presented our findings at the Society for Cardiothoracic Surgery for Great Britain & Ireland's [2012 Annual Meeting][5].\r\n\r\n### The Error\r\n\r\nSFAR's Thoracoscore calculator uses the [following function][11] to attempt to round the calculated score (`x`) to 2 decimal places:\r\n\t\r\n```javascript\r\n\tfunction Fmt(x) {\r\n\t\tvar v\r\n\t\tif (x >= 0) {\r\n\t\t\tv = '' + (x + 0.05)\r\n\t\t} else {\r\n\t\t\tv = '' + (x - 0.05)\r\n\t\t}\r\n\t\treturn v.substring(0,v.indexOf('.')+3)\r\n\t}\r\n```\r\n\r\nHowever, as `x` is _always_ ≥0, 0.05 is _always_ added to `x` before the `substring` method truncates the string to 2 places beyond the `.` (i.e. to 2 decimal places).\r\n\r\nInstead of _rounding_ to 2 decimal places, this function __adds__ 0.05 and then __truncates__ the result to 2 decimal places.\r\n\r\nWe suggest the alternative:\r\n\r\n```javascript\r\n\tfunction Fmt(x) {\r\n\t\treturn Math.round(x * 100) / 100;\r\n\t}\r\n```\r\n\r\n### Files\r\n\r\nWe provide 3 files:\r\n\r\n - [thoracoscore2.php][8] - The original source from SFAR's website: http://www.sfar.org/scores2/thoracoscore2.php. Accessed 2012-04-15 19:00.\r\n - [calculator.html][9] - Tidied version of the original calculator.\r\n - [fixed.html][10] - Patched version of calculator.html\r\n\r\n### Presentation\r\n\r\nWe presented our findings at the Society for Cardiothoracic Surgery for Great Britain & Ireland's [2012 Annual Meeting][5].\r\nOur slides are [on SpeakerDeck][6]:\r\n\r\n[![Title slide][7]][6]\r\n\r\n### Authors\r\n\r\n - Kenrick Turner ([@kenners][12]), Norfolk & Norwich University Hospital\r\n - Andrew Ho ([@andrewlkho][13]), St. George's Hospital, London\r\n - Gunnar Rø ([@gulfa][14]), University of Durham\r\n - Filip Van Tornout, Norfolk & Norwich University Hospital\r\n\r\n### Contact\r\n\r\nCorrespondance should be addressed to Kenrick: kenrickturner[at]nhs.net\r\n\r\n[1]: http://www.sfar.org \"Société Française d’Anesthésie et de Réanimation's website\"\r\n[2]: http://www.google.com/search?q=thoracoscore \"Search Google for 'thoracoscore'\"\r\n[3]: http://dx.doi.org/10.1016/j.jtcvs.2006.09.020 \"Falcoz et al. The Thoracic Surgery Scoring System. J Thorac Cardiovasc Surg. 2007 Feb;133(2):325-32\"\r\n[4]: http://www.sfar.org/scores2/thoracoscore2.php  \"SFAR's Thoracoscore calculator\"\r\n[5]: http://www.scts.org/annual_meeting \"SCTS Annual Meeting 2012\"\r\n[6]: http://speakerdeck.com/u/kenrick/p/an-error-in-a-web-based-thoracoscore-calculator \"Our slides from the SCTS Annual Meeting\"\r\n[7]: https://speakerd.s3.amazonaws.com/presentations/4f7ef74fe711f6001f009075/thumb_slide_0.jpg \"Title slide from our presentation\"\r\n[8]: https://github.com/kenners/SFAR-thoracoscore/blob/master/thoracoscore2.php\r\n[9]: https://github.com/kenners/SFAR-thoracoscore/blob/master/calculator.html\r\n[10]: https://github.com/kenners/SFAR-thoracoscore/blob/master/fixed.html\r\n[11]: https://github.com/kenners/SFAR-thoracoscore/blob/master/thoracoscore2.php#L114\r\n[12]: https://github.com/kenners \"Kenrick on GitHub\"\r\n[13]: https://github.com/andrewlkho \"Andrew on GitHub\"\r\n[14]: https://github.com/gulfa \"Gunnar on GitHub\"","tagline":"Bugfix for the rounding error in SFAR's Thoracoscore calculator","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}